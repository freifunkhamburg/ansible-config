include /etc/nginx/include/node_hierarchy.conf;

{% if updates_ssl_certificate is defined %}
server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name updates.hamburg.freifunk.net;

    ssl_certificate {{ updates_ssl_certificate }};
    ssl_certificate_key {{ updates_ssl_certificate_key }};

    root {{ updates_root }};
    include /etc/nginx/include/updates_domains.conf;
    include /etc/nginx/include/listing.conf;

    location / {
        include /etc/nginx/include/headers_hsts.conf;
    }

    location = /config {
        root /etc/nginx/include;
        try_files /node_hierarchy.conf =404;
        default_type text/plain;
    }
}

{% endif %}
# Kein HTTPS Redirect wg. Paketinstallation auf Routern
server {
    listen 80;
    listen [::]:80;

    server_name updates.hamburg.freifunk.net;

    root {{ updates_root }};
    include /etc/nginx/include/updates_domains.conf;
    include /etc/nginx/include/listing.conf;
{% if updates_letsencrypt_local %}

    include /etc/nginx/include/letsencrypt.conf;
{% endif %}
{% if updates_letsencrypt_srv01 %}

    include /etc/nginx/include/letsencrypt_srv01.conf;
{% endif %}
{% if updates_letsencrypt_srv02 %}

    include /etc/nginx/include/letsencrypt_srv02.conf;
{% endif %}
}

server {
    listen 80;
    listen [::]:80;

    server_name *.updates.services.ffhh;

    root {{ updates_root }};
    include /etc/nginx/include/updates_domains.conf;
    include /etc/nginx/include/listing.conf;
}
